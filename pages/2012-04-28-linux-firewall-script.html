<p>rc.firewall file </p>
<pre>
# Internet Configuration.
INET_IP="210.7.94.112/255.255.255.128"
INET_IFACE="eth1"
INET_BROADCAST="210.7.94.127"

# Local Area Network configuration.
LAN_IP="192.168.1.1"
LAN_IP_RANGE="192.168.1.0/24"
LAN_IFACE="eth0"

# Localhost Configuration.
LO_IFACE="lo"
LO_IP="127.0.0.1"

# IPTables Configuration.
IPTABLES="/sbin/iptables"

# Module loading.
/sbin/depmod -a
/sbin/modprobe ip_tables
/sbin/modprobe ip_conntrack
/sbin/modprobe iptable_filter
/sbin/modprobe iptable_mangle
/sbin/modprobe iptable_nat
/sbin/modprobe ipt_LOG
/sbin/modprobe ipt_limit
/sbin/modprobe ipt_state

# /proc set up.
echo "1" > /proc/sys/net/ipv4/ip_forward

# Delete old chains for ICMP, TCP and UDP to traverse
$IPTABLES -F
$IPTABLES -X allowed
$IPTABLES -X tcp_packets
$IPTABLES -X udp_packets
$IPTABLES -X icmp_packets

# Set Default Policy
$IPTABLES -P INPUT DROP
$IPTABLES -P OUTPUT DROP
$IPTABLES -P FORWARD DROP
#$IPTABLES -P INPUT ACCEPT
#$IPTABLES -P OUTPUT ACCEPT
#$IPTABLES -P FORWARD ACCEPT
# Defaults are to DROP anything sent to the firewall or internal network and to permit
# anything going out.

$IPTABLES -t filter -P INPUT DROP
$IPTABLES -t filter -P FORWARD DROP
$IPTABLES -t filter -P OUTPUT ACCEPT
$IPTABLES -t nat -P PREROUTING ACCEPT
$IPTABLES -t nat -P POSTROUTING ACCEPT
$IPTABLES -t nat -P OUTPUT ACCEPT

$IPTABLES -t filter -A INPUT -i $INET_IFACE -p TCP --tcp-flags ALL NONE -j REJECT --reject-with icmp-host-unreachable
$IPTABLES -t filter -A INPUT -i $INET_IFACE -p TCP --tcp-flags SYN,FIN SYN,FIN -j REJECT --reject-with icmp-host-unreachable
$IPTABLES -t filter -A INPUT -i $INET_IFACE -p TCP --tcp-flags SYN,RST SYN,RST -j REJECT --reject-with icmp-host-unreachable
$IPTABLES -t filter -A INPUT -i $INET_IFACE -p TCP --tcp-flags FIN,RST FIN,RST -j REJECT --reject-with icmp-host-unreachable
$IPTABLES -t filter -A INPUT -i $INET_IFACE -p TCP --tcp-flags ACK,FIN FIN -j REJECT --reject-with icmp-host-unreachable
#$IPTABLES -t filter -A INPUT -i $INET_IFACE -p TCP --tcp-flags ACK,PSH PSH -j REJECT --reject-with icmp-host-unreachable
#$IPTABLES -t filter -A INPUT -i $INET_IFACE -p TCP --tcp-flags ACK,URG URG -j REJECT --reject-with icmp-host-unreachable
$IPTABLES -t filter -A INPUT -i $INET_IFACE -f -j DROP
# Allow all packets to be travelled on local network
$IPTABLES -A INPUT -p ALL -s $LAN_IP_RANGE -d $LAN_IP_RANGE -j ACCEPT
$IPTABLES -A OUTPUT -p ALL -s $LAN_IP_RANGE -d $LAN_IP_RANGE -j ACCEPT

# Create chain for bad tcp packets
$IPTABLES -N allowed
$IPTABLES -N tcp_packets
$IPTABLES -N udp_packets
$IPTABLES -N icmp_packets


$IPTABLES -t nat -A PREROUTING -p TCP -i $INET_IFACE -d $INET_IP --dport 9040 -j DNAT --to-destination 192.168.1.2:80
$IPTABLES -t nat -A PREROUTING -p TCP -i $INET_IFACE -d $INET_IP --dport 1494 -j DNAT --to-destination 192.168.1.2
# allowed chain
$IPTABLES -A FORWARD -i eth1 -o eth0 -p TCP --dport 9040 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
$IPTABLES -A FORWARD -i eth1 -o eth0 -p TCP --dport 1494 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT
$IPTABLES -A FORWARD -i eth1 -o eth0 -p TCP --dport 5000 -m state --state NEW,ESTABLISHED,RELATED -j DROP
$IPTABLES -A FORWARD -i eth1 -o eth0 -p TCP --dport 5005 -m state --state NEW,ESTABLISHED,RELATED -j DROP
$IPTABLES -A FORWARD -i eth1 -o eth0 -p TCP --dport 5010 -m state --state NEW,ESTABLISHED,RELATED -j DROP
$IPTABLES -A FORWARD -i eth1 -o eth0 -p TCP --dport 5050 -m state --state NEW,ESTABLISHED,RELATED -j DROP

$IPTABLES -A allowed -p TCP --syn -j ACCEPT
$IPTABLES -A allowed -p TCP -m state --state ESTABLISHED,RELATED -j ACCEPT
$IPTABLES -A allowed -p TCP -j DROP

# TCP rules
$IPTABLES -A tcp_packets -p TCP -s 0/0 --dport 110 -j allowed
$IPTABLES -A tcp_packets -p TCP -s 0/0 --dport 25 -j DROP
$IPTABLES -A tcp_packets -p TCP -s 0/0 --dport 22 -j allowed
$IPTABLES -A tcp_packets -p TCP -s 0/0 --dport 80 -j allowed
#$IPTABLES -A tcp_packets -p TCP -s $LAN_IP_RANGE --dport 25 -j DROP
#$IPTABLES -A tcp_packets -p TCP -s $LAN_IP_RANGE --dport 3128 -j allowed

######### PAT For CITRIX Server ##########
$IPTABLES -A tcp_packets -p TCP -s 0/0 --dport 9040 -j allowed
$IPTABLES -A tcp_packets -p TCP -s 0/0 --dport 1494 -j allowed

######For Momentum Chat Server ###########
$IPTABLES -A tcp_packets -p TCP -s 0/0 --dport 5222 -j allowed
$IPTABLES -A tcp_packets -p TCP -s 0/0 --dport 5222 -j allowed
$IPTABLES -A tcp_packets -p TCP -s 0/0 --dport 10000 -j allowed
$IPTABLES -A tcp_packets -p TCP -s 0/0 --dport 20000 -j allowed
$IPTABLES -A tcp_packets -p TCP -s 0/0 --destination-port 5000:5050 -j drop
$IPTABLES -A tcp_packets -p TCP -s 0/0 --destination-port 5000:5050 -j drop


#In this example iptables is being configured to allow the firewall send ICMP echo-requests 
# and in turn, accept the expected ICMP echo-replies. 

$IPTABLES -A OUTPUT -p icmp --icmp-type echo-request -j ACCEPT
$IPTABLES -A INPUT  -p icmp --icmp-type echo-reply   -j ACCEPT
# UDP ports
$IPTABLES -A udp_packets -p UDP -s 0/0 --source-port 53 -j ACCEPT
$IPTABLES -A udp_packets -p UDP -s 0/0 --source-port 123 -j ACCEPT
$IPTABLES -A udp_packets -p UDP -s 0/0 --source-port 2074 -j ACCEPT
$IPTABLES -A udp_packets -p UDP -s 0/0 --source-port 4000 -j ACCEPT

# In Microsoft Networks you will be swamped by broadcasts. These lines
# will prevent them from showing up in the logs.
$IPTABLES -A udp_packets -p UDP -i $INET_IFACE -d $INET_BROADCAST --destination-port 135:139 -j DROP

# If we get DHCP requests from the Outside of our network, our logs will
# be swamped as well. This rule will block them from getting logged.
$IPTABLES -A udp_packets -p UDP -i $INET_IFACE -d 255.255.255.255 --destination-port 67:68 -j DROP

# ICMP rules
$IPTABLES -A icmp_packets -p ICMP -s 0/0 --icmp-type 8 -j ACCEPT
$IPTABLES -A icmp_packets -p ICMP -s 0/0 --icmp-type 11 -j ACCEPT


# Rules for special networks not part of the Internet
$IPTABLES -A INPUT -p ALL -i $LO_IFACE -s $LO_IP -j ACCEPT
$IPTABLES -A INPUT -p ALL -i $LO_IFACE -s $LAN_IP -j ACCEPT
$IPTABLES -A INPUT -p ALL -i $LO_IFACE -s $INET_IP -j ACCEPT

# Rules for incoming packets from anywhere.
$IPTABLES -A INPUT -p ALL -d $INET_IP -m state --state ESTABLISHED,RELATED -j ACCEPT
$IPTABLES -A INPUT -p TCP -j tcp_packets
$IPTABLES -A INPUT -p UDP -j udp_packets
$IPTABLES -A INPUT -p ICMP -j icmp_packets

###Allow incoming packets for following ports only
$IPTABLES -A INPUT -i $INET_IFACE -s 0.0.0.0 -d $INET_IP -p 110 -j ACCEPT
$IPTABLES -A INPUT -i $INET_IFACE -s 0.0.0.0 -d $INET_IP -p 25 25  -j ACCEPT
$IPTABLES -A INPUT -i $INET_IFACE -s 0.0.0.0 -d $INET_IP -p 80 -j ACCEPT
$IPTABLES -A INPUT -i $INET_IFACE -s 0.0.0.0 -d $INET_IP -p 9040 -j ACCEPT
$IPTABLES -A INPUT -i $INET_IFACE -s 0.0.0.0 -d $INET_IP -p 1494 -j ACCEPT
$IPTABLES -A INPUT -i $INET_IFACE -s 0.0.0.0 -d $INET_IP -p 10000 -j ACCEPT
$IPTABLES -A INPUT -i $INET_IFACE -s 0.0.0.0 -d $INET_IP -p 20000 -j ACCEPT


###### For momentum chat server ##########
$IPTABLES -A INPUT -i $INET_IFACE -s 0.0.0.0 -d $INET_IP -p 5222 -j ACCEPT
$IPTABLES -A INPUT -i $INET_IFACE -s 0.0.0.0 -d $INET_IP -p 5269 -j ACCEPT

# If you have a Microsoft Network on the outside of your firewall, you may also
# get flooded by Multicasts. We drop them so we do not get flooded by logs

# Log weird packets that don't match the above.
$IPTABLES -A INPUT -m limit --limit 3/minute --limit-burst 3 -j LOG --log-level DEBUG --log-prefix "IPT INPUT packet died: "


# Accept the packets we actually want to forward
$IPTABLES -t nat -A POSTROUTING -d ! 192.168.1.0/24  -j MASQUERADE

# Accept packets to/from Silentwitness network (Only for Local Interfaces)
$IPTABLES -A FORWARD -i eth0 -o eth1 -j ACCEPT
$IPTABLES -A FORWARD -i eth1 -o eth0 -j ACCEPT
#$IPTABLES -A FORWARD -i eth2 -o eth0 -j ACCEPT
#$IPTABLES -A FORWARD -i eth2 -o eth1 -j ACCEPT

#Anupam
$IPTABLES -A FORWARD -s 192.168.1.7 -j ACCEPT
#$IPTABLES -A FORWARD -d 192.168.1.7 -j ACCEPT
#devendra
#vinod
$IPTABLES -A FORWARD -s 192.168.1.99 -j ACCEPT
$IPTABLES -A FORWARD -d 192.168.1.99 -j ACCEPT

#Jitender
$IPTABLES -A FORWARD -s 192.168.1.236 -j ACCEPT
$IPTABLES -A FORWARD -d 192.168.1.236 -j ACCEPT

$IPTABLES -A FORWARD -s 192.168.1.120 -j ACCEPT
$IPTABLES -A FORWARD -d 192.168.1.120 -j ACCEPT

# Log weird packets that don't match the above.
#

$IPTABLES -A FORWARD -m limit --limit 3/minute --limit-burst 3 -j LOG --log-level DEBUG --log-prefix "IPT FORWARD packet died: "

#
# 4.1.6 OUTPUT chain
#

#
# Bad TCP packets we don't want.
#


#
# Special OUTPUT rules to decide which IP's to allow.
#

$IPTABLES -A OUTPUT -p ALL -s $LO_IP -j ACCEPT
$IPTABLES -A OUTPUT -p ALL -s $LAN_IP -j ACCEPT
$IPTABLES -A OUTPUT -p ALL -s $INET_IP -j ACCEPT

# Log weird packets that don't match the above.
$IPTABLES -A OUTPUT -m limit --limit 3/minute --limit-burst 3 -j LOG --log-level DEBUG --log-prefix "IPT OUTPUT packet died: "

# Enable simple IP Forwarding and Network Address Translation


</pre>
